"use strict";angular.module("minionsManagedNgApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("minionsManagedNgApp").controller("MainCtrl",["$scope","mmApi",function(a,b){function c(){b.counts({state:a.selected.state},function(b){a.workerTypes=[],a.dataCenters=[],a.counts={},b.forEach(function(b){a.workerTypes.indexOf(b._id.workerType)<0&&(a.workerTypes.push(b._id.workerType),a.workerTypes.sort()),a.dataCenters.indexOf(b._id.dataCenter)<0&&(a.dataCenters.push(b._id.dataCenter),a.dataCenters.sort()),null==a.counts[b._id.workerType]&&(a.counts[b._id.workerType]={count:0}),a.counts[b._id.workerType][b._id.dataCenter]=b.count,a.counts[b._id.workerType].count+=b.count}),a.loading.counts=!1})}function d(a,b){return 1===a?b:b+"s"}a.workerTypes=["gecko-t-win7-32","gecko-t-win7-32-gpu","gecko-t-win10-64","gecko-t-win10-64-gpu","gecko-1-b-win2012","gecko-2-b-win2012","gecko-3-b-win2012"],a.dataCenters=["use1","use2","usw1","usw2","euc1"],a.selected={state:"alive",workerType:a.workerTypes[0],dataCenter:a.dataCenters[0]},a.getData=function(d,e){a.loading={counts:!0,minions:!0},a.dataCenters=[],c(),a.selected.workerType=d,a.selected.dataCenter=e,b.query({state:a.selected.state,workerType:a.selected.workerType,dataCenter:a.selected.dataCenter},function(b){a.minions=b,a.loading.minions=!1})},a.getUptime=function(a){if(null==a)return"unknown";var b=(new Date-new Date(a))/1e3,c=Math.floor(b/86400),e=Math.floor((b-86400*c)/3600),f=Math.floor((b-86400*c-3600*e)/60),g=Math.floor(b-86400*c-3600*e-60*f);return c>0?c+" "+d(c,"day"):e>0?e+" "+d(e,"hour"):f>0?f+" "+d(f,"minute"):g+d(g,"second")},a.getRegion=function(a){switch(a){case"use1":return"us-east-1";case"use2":return"us-east-2";case"usw1":return"us-west-1";case"usw2":return"us-west-2";case"euc1":return"eu-central-1";default:return a}},a.getData(a.selected.workerType,a.selected.dataCenter)}]),angular.module("minionsManagedNgApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("minionsManagedNgApp").factory("mmApi",["$resource",function(a){var b="https://api.minions-managed.tk/";return a(b,{state:"@_state",workerType:"@_workerType",dataCenter:"@_dataCenter"},{query:{url:b+"minions/:state/:workerType/:dataCenter",isArray:!0},counts:{url:b+"minion/:state/count",method:"GET",isArray:!0}})}]),angular.module("minionsManagedNgApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<ul class="nav nav-tabs"> <li ng-repeat="workerType in workerTypes" ng-class="{active: workerType === selected.workerType}" ng-show="counts[workerType].count"> <a class="pointer" ng-click="getData(workerType, selected.dataCenter)">{{workerType}} ({{counts[workerType].count}})</a> </li> </ul> <div style="padding: 10px"> <ul class="nav nav-tabs" ng-hide="loading.counts"> <li ng-repeat="dataCenter in dataCenters" ng-class="{active: dataCenter === selected.dataCenter}" ng-show="counts[selected.workerType][dataCenter]"> <a class="pointer" ng-click="getData(selected.workerType, dataCenter)">{{getRegion(dataCenter)}} ({{counts[selected.workerType][dataCenter]}})</a> </li> </ul> </div> <div ng-show="loading.counts || loading.minions" class="spinner"> <div class="cube1"></div> <div class="cube2"></div> </div> <div class="clearfix col-sm-2" ng-repeat="minion in minions | orderBy : \'created\'" ng-hide="loading.minions"> <div class="panel" ng-class="{\n    \'panel-default\': (minion.tasks.length === 0 && (minion.restarts.length - minion.tasks.length) < 2),\n    \'panel-info\': (minion.tasks.length > 0 && (minion.restarts.length - minion.tasks.length) < 2),\n    \'panel-warning\': ((minion.restarts.length - minion.tasks.length) === 2),\n    \'panel-danger\': ((minion.restarts.length - minion.tasks.length) > 2)\n  }"> <div class="panel-heading"> <h4 class="panel-title"> <a class="pointer" ng-click="minion.showbody=!minion.showbody">{{minion._id.replace(\'0000000\', \'i-\')}}</a> </h4> tasks: {{minion.tasks.length}}, restarts: {{minion.restarts.length}}, uptime: <span>{{getUptime(minion.created)}}</span> </div> <div class="panel-body" ng-show="minion.showbody"> <ul> <li>ip: {{minion.ipAddress}}</li> <li>created: {{minion.created}}</li> <li> <a href="https://papertrailapp.com/groups/2488493/events?q={{minion._id.replace(\'0000000\', \'i-\')}}">event logs</a> </li> <li> <a href="https://console.aws.amazon.com/ec2/v2/home?region={{getRegion(minion.dataCenter)}}#Instances:instanceId={{minion._id.replace(\'0000000\', \'i-\')}}">ec2 console</a> </li> <li> <a class="pointer" ng-click="minion.showtasks=!minion.showtasks">tasks ({{minion.tasks.length}})</a> <ul ng-show="minion.tasks.length && minion.showtasks"> <li ng-repeat="task in minion.tasks"> <a href="https://tools.taskcluster.net/task-inspector/#{{task.id}}">{{task.id}}</a> </li> </ul> </li> <li> <a style="cursor: pointer" ng-click="minion.showrestarts=!minion.showrestarts">restarts ({{minion.restarts.length}})</a> <ul ng-show="minion.restarts.length && minion.showrestarts"> <li ng-repeat="restart in minion.restarts"> {{restart.time}}<br> {{restart.user}}<br> {{restart.comment}} </li> </ul> </li> </ul> </div> </div> </div>')}]);